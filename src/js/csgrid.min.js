!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("jquery")):t.csgrid=e(t.jQuery)}(this,function(t){var e={columns:null,data:null,url:null,queryParams:{},pager:!1,pageNumber:1,pageSize:5,rowHeight:40,height:null,noDataText:"No Data",footer:!1,footerMsg:"Total {total} items",queryFilter:null,loadFilter:null,onBeforeLoad:null,onLoadSuccess:null},i={template:function(e,i){if(!e||!i)return e;var a=/{(.*?)}/g,n=e.match(a);return t.each(n,function(t,n){var r=n.replace(a,"$1"),o=i[r];void 0!==o&&(e=e.replace(n,o))}),e}},a={name:"csgrid",getCls:function(){var t=this.name+"-";return{load:t+"f",header:t+"header",body:t+"body",footer:t+"footer",noData:t+"nodata",cell:t+"cell",emptyCell:t+"emptycell"}},init:function(t){var e=t.options,i=e.columns;i&&0!==i.length&&(e.mergeColumns=this.mergeCols(i),e.realData={total:0,rows:[]},this.cls||(this.cls=this.getCls()),this.grid(t).attr("id",t.instanceId),this.initHeader(t),this.reload(t))},grid:function(e,i){var a,n=t(e.dom),r=this.cls,o=r.load;return n.hasClass(o)?(a=n.parent(),i?this.child(a,i):a):(n.addClass(o).hide(),(a=t('<div class="'+this.name+'"><div class="'+r.header+'"></div><div class="'+r.body+'"></div></div>')).insertAfter(n),n.appendTo(a),a)},child:function(t,e){return t.children("div."+this.cls[e])},mergeCols:function(e){var i=e[0],a=e[1],n=[];if(!t.isArray(i))return e;var r=a&&a.concat();return t.each(i,function(t,e){var i=e.field,a=e.colspan;if(i)n.push(e);else if(a&&r){var o=r.splice(0,a);n=n.concat(o)}}),n},initHeader:function(e){this.resize(e);var i=t("<table><tbody></tbody></table>");this.grid(e,"header").html(i),this.fillHeader(i.children("tbody"),e.options.columns)},fillHeader:function(e,i){var a=t("<tr></tr>"),n=!0,r=this,o=r.cls.cell;t.each(i,function(i,s){if(t.isArray(s))return n=!1,void r.fillHeader(e,s);var l="<td",d="<div",c=s.colspan,h=s.rowspan,u=s.haligh,f=s.field,p=s.title;c&&(l+=' colspan="'+c+'"'),h&&(l+=' rowspan="'+h+'"'),f&&(d+=' class="'+o+" "+o+"-"+f+'"'),u&&(d+=' style="text-align:'+u+';"'),l+=">"+(d+=' title="'+p+'">'+p+"</div>")+"</td>",a.append(l)}),n&&e.append(a)},getColWitdh:function(t,e){var i=parseInt(t);return isNaN(i)?"auto":parseInt(/%$/.test(t)?i/100*e:i)-2+"px"},createCellStyle:function(e,i,a){var n=i.options.mergeColumns,r=i.instanceId,o=this,s=['<style type="text/css" '+o.name+'="true" data-target="'+r+'">'],l=o.cls.cell+"-";t.each(n,function(t,e){var i=e.field;if(i){var n=o.getColWitdh(e.width,a);"auto"!==n&&s.push("#"+r+" ."+l+i+"{width:"+n+"}")}}),s.push("</style>"),t(s.join("\n")).appendTo(e)},removeCellStyle:function(t){t.children("style["+this.name+"]").remove()},resize:function(t){var e=this.grid(t);if(!e.is(":hidden")){var i=this.child(e,"header"),a=this.child(e,"body"),n=a.children("table"),r=parseInt(e.css("width"));this.hasScrollbar(a)&&(r-=20,this.addEmptyCell(i)),parseInt(n.css("width"))===r&&e.children("style[data-target="+t.instanceId+"]").length>0||(n.css("width",r),i.children("table").css("width",r),this.removeCellStyle(e),this.createCellStyle(e,t,r))}},hasScrollbar:function(t){var e=t.children("table")[0];return e&&parseInt(t.css("height"))<parseInt(e.style.height)},addEmptyCell:function(t){var e=this.cls.emptyCell,i='<div class="'+e+'"></div>';0===t.children("."+e).length&&t.append(i)},initBody:function(t,e){var i=t.options,a=this.grid(t,"body");return a.empty().css("height",e?"auto":i.height||i.pageSize*i.rowHeight),a},showNoData:function(t){this.initBody(t,!0).html('<div class="'+this.cls.noData+'">'+t.options.noDataText+"</div>")},initFooter:function(e){var a,n=this.grid(e),r=this.child(n,"footer"),o=e.options,s=o.footer,l=o.realData;if("function"==typeof s)a=s.call(e.dom,l);else{if(!0!==s)return;a=i.template(o.footerMsg,l)}0===r.length&&(r=t('<div class="'+this.cls.footer+'"></div>')).appendTo(n),r.html(a)},reload:function(t){this.initBody(t);var e=t.options,i=e.onBeforeLoad;i&&i.call(t.dom),e.url?this.ajaxData(t):this.loadData(t)},parseData:function(e){var i=e.data;if(e.pager&&t.isArray(i)){var a=e.pageNumber*e.pageSize,n=a-e.pageSize;i=i.slice(n,a)}return t.isArray(i)?{total:e.data.length,rows:i}:i},ajaxData:function(e){var i=e.options,a=this;if(i.pager){var n=i.queryParams,r=i.queryFilter;t.extend(n,{page:i.pageNumber,row:i.pageSize}),r&&(n=r.call(e.dom,n)),i.queryParams=n}t.post(i.url,i.queryParams,function(t){i.data=t,a.loadData(e)})},loadData:function(e){var i=e.options,a=e.dom,n=i.loadFilter,r=i.onLoadSuccess;n&&(i.data=n.call(a,i.data));var o=this.parseData(i);if(i.realData=o,this.initFooter(e),o&&o.total){var s=this.cls,l=this.grid(e),d=this.child(l,"body"),c=t("<table><tbody></tbody></table>"),h=c.children("tbody"),u=i.mergeColumns,f=o.rows,p=f.length*i.rowHeight,g=i.height,v=s.cell;(!g||g>p)&&d.css("height",p),c.css("height",p).appendTo(d),this.resize(e),t.each(f,function(e,i){var a=t('<tr data-index="'+e+'"></tr>');t.each(u,function(t,n){var r=n.field;if(r){var o=void 0===i[r]?"":i[r],s="",l="",d=n.rowStyler,c=n.formatter,h=n.tooltip,u=n.align,f=a[0];d&&(s=d.call(f,o,e,i)),c&&(o=c.call(f,o,e,i)),"function"==typeof h?l=h.call(f,o,e,i):!0===h&&(l=o);var p='<div class="'+v+" "+v+"-"+r+'"';u?(p+=' style="text-align:'+u+";",s&&(p+=s),p+='"'):s&&(p+=' style="'+s+'"'),l&&(p+=' title="'+l+'"'),p+=">"+o+"</td>",a.append("<td>"+p+"</td>")}}),h.append(a)})}else this.showNoData(e);r&&r.call(a,o)}},n=function(i,n){this.instanceId=a.name+(new Date).valueOf(),this.dom=i,this.options=t.extend({},e,n)};return n.prototype={constructor:n,init:function(){a.init(this)},reload:function(e){t.extend(this.options,e),a.reload(this)},loadData:function(t){this.reload({data:t})},grid:function(t){return a.grid(this,t)},resize:function(){return a.resize(this)}},t.fn.csgrid=function(e,i){return"string"==typeof e?t.fn.csgrid.methods[e](this[0],i):this.each(function(){var i=new n(this,e);return t.data(this,a.name,i),i.init(),i})},t.fn.csgrid.methods={instance:function(e){return t.data(e,a.name)},options:function(t){return this.instance(t).options},reload:function(t,e){return this.instance(t).reload(e)},loadData:function(t,e){return this.instance(t).loadData(e)},getData:function(t){return this.options(t).realData},grid:function(t,e){return this.instance(t).grid(e)},body:function(t){return this.grid(t,"body")},resize:function(t){return this.instance(t).resize()}},t.fn.csgrid.defaults=e,n});